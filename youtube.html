<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Live Subscriber Count</title>
    <!-- Link to YouTube icon as favicon -->
    <link rel="icon" href="youtube-icon.png" type="image/png">
    <!-- Link to Google Fonts for Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <!-- Link to FontAwesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <!-- Link to Odometer CSS from local path -->
    <link rel="stylesheet" href="odometer-theme-default.css" />
    <link rel="stylesheet" href="youtube.css">
</head>
<body>
    <h1><i class="fab fa-youtube" style="color: #FF0000;"></i> YouTube Live Subscriber Count</h1>

    <div class="container">
        <div class="channel-banner" id="channel-banner"></div>
        <div class="avatar" id="avatar"></div>
        <div class="channel-name" id="channel-name">Channel Name</div>
        <div class="subscriber-count odometer" id="subscriber-count">0</div>
        <div class="subscriber-label" id="subscriber-label">Subscribers</div> <!-- Added ID here -->
    </div>
    <button class="home-button" onclick="window.location.href='index.html'">Go Back to Homepage</button>

    <!-- Include Odometer JS from local path -->
    <script src="odometer.min.js"></script>
    <script>
function getChannelIdFromUrl() {
    // Get the query string from the URL
    const queryString = window.location.search;

    // Remove the leading "?" and return the channel ID
    return queryString.substring(1);
}

        async function fetchYouTubeData() {
            const channelId = getChannelIdFromUrl();
            if (!channelId) {
                console.error('Channel ID not found in URL');
                return;
            }

            try {
                const response = await fetch(`https://backend.mixerno.space/api/youtube/estv3/${channelId}`);
                const data = await response.json();

                // Check if the response contains valid data
                if (data.success && data.items && data.items.length > 0) {
                    const channelData = data.items[0];

                    // Update channel banner
                    const channelBanner = document.getElementById('channel-banner');
                    if (channelBanner) {
                        channelBanner.style.backgroundImage = `url(${channelData.brandingSettings.image})`;
                    }

                    // Update avatar
                    const avatar = document.getElementById('avatar');
                    if (avatar) {
                        avatar.style.backgroundImage = `url(${channelData.snippet.thumbnails.default.url})`;
                    }

                    // Update channel name
                    const channelName = document.getElementById('channel-name');
                    if (channelName) {
                        channelName.textContent = channelData.snippet.title;
                    }

                    // Update subscriber count using Odometer
                    const subscriberCountElement = document.getElementById('subscriber-count');
                    if (subscriberCountElement) {
                        subscriberCountElement.innerHTML = channelData.statistics.subscriberCount;
                    }

                    // Update subscriber label
                    const subscriberLabel = document.getElementById('subscriber-label');
                    if (subscriberLabel) {
                        subscriberLabel.textContent = 'Subscribers';
                    }
                } else {
                    console.error('No valid channel data found in the response');
                    // Fallback: Display a message or default values
                    const channelName = document.getElementById('channel-name');
                    if (channelName) {
                        channelName.textContent = 'Channel not found';
                    }

                    const subscriberCountElement = document.getElementById('subscriber-count');
                    if (subscriberCountElement) {
                        subscriberCountElement.innerHTML = '0';
                    }

                    const subscriberLabel = document.getElementById('subscriber-label');
                    if (subscriberLabel) {
                        subscriberLabel.textContent = 'Subscribers (unavailable)';
                    }
                }
            } catch (error) {
                console.error('Error fetching YouTube data:', error);
                // Fallback: Display an error message
                const channelName = document.getElementById('channel-name');
                if (channelName) {
                    channelName.textContent = 'Error loading data';
                }

                const subscriberCountElement = document.getElementById('subscriber-count');
                if (subscriberCountElement) {
                    subscriberCountElement.innerHTML = '0';
                }

                const subscriberLabel = document.getElementById('subscriber-label');
                if (subscriberLabel) {
                    subscriberLabel.textContent = 'Subscribers (unavailable)';
                }
            }
        }

        // Fetch data every 2 seconds
        setInterval(fetchYouTubeData, 2000);

        // Initial fetch
        fetchYouTubeData();
    </script>
</body>
</html>